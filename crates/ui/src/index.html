<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sankshepa Realtime Logs</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #d4d4d4;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: #333;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #log-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            font-family: 'Cascadia Code', 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            display: flex;
            gap: 10px;
        }

        .ts {
            color: #569cd6;
            min-width: 180px;
        }

        .node {
            color: #dcdcaa;
            min-width: 100px;
            font-weight: bold;
        }

        .host {
            color: #ce9178;
            min-width: 100px;
        }

        .app {
            color: #4ec9b0;
            min-width: 80px;
        }

        .msg {
            color: #d4d4d4;
        }

        .severity {
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.8em;
            text-transform: uppercase;
        }

        .sev-0 {
            background-color: #c41e3a;
            color: white;
        }

        /* emergency */
        .sev-1 {
            background-color: #ff0000;
            color: white;
        }

        /* alert */
        .sev-2 {
            background-color: #ff4500;
            color: white;
        }

        /* critical */
        .sev-3 {
            background-color: #ffa500;
            color: black;
        }

        /* error */
        .sev-4 {
            background-color: #ffff00;
            color: black;
        }

        /* warning */
        .sev-5 {
            background-color: #0000ff;
            color: white;
        }

        /* notice */
        .sev-6 {
            background-color: #00ff00;
            color: black;
        }

        /* info */
        .sev-7 {
            background-color: #808080;
            color: white;
        }

        /* debug */
    </style>
</head>

<body>
    <header>
        <div>Sankshepa Realtime Logs</div>
        <div style="flex-grow: 1; margin: 0 40px; display: flex; align-items: center; gap: 10px;">
            <input type="text" id="filter-input" placeholder="Search logs..."
                style="width: 100%; padding: 5px 10px; border-radius: 4px; border: 1px solid #555; background: #222; color: #fff;">
            <label style="font-size: 0.8em; white-space: nowrap;">
                <input type="checkbox" id="auto-scroll" checked> Auto-Scroll
            </label>
        </div>
        <div id="status">Connecting...</div>
    </header>
    <div id="log-container"></div>

    <script>
        const logContainer = document.getElementById('log-container');
        const status = document.getElementById('status');
        const filterInput = document.getElementById('filter-input');
        const autoScroll = document.getElementById('auto-scroll');
        const eventSource = new EventSource('/events');

        let currentFilter = "";
        filterInput.oninput = (e) => {
            currentFilter = e.target.value.toLowerCase();
            // Apply filter to existing logs
            Array.from(logContainer.children).forEach(entry => {
                const text = entry.textContent.toLowerCase();
                entry.style.display = text.includes(currentFilter) ? 'flex' : 'none';
            });
        };

        eventSource.onopen = () => {
            status.textContent = 'Connected';
            status.style.color = '#4ec9b0';
        };

        eventSource.onerror = (e) => {
            console.error('SSE Error:', e);
            status.textContent = 'Disconnected (Check Console)';
            status.style.color = '#c41e3a';
        };

        eventSource.onmessage = (event) => {
            console.log('Received event:', event.data);
            const msg = JSON.parse(event.data);
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            const ts = document.createElement('span');
            ts.className = 'ts';
            ts.textContent = msg.timestamp ? new Date(msg.timestamp).toLocaleString() : '-';

            const node = document.createElement('span');
            node.className = 'node';
            node.textContent = msg.node_id || '-';

            const sev = document.createElement('span');
            sev.className = `severity sev-${msg.severity}`;
            sev.textContent = getSeverityName(msg.severity);

            const host = document.createElement('span');
            host.className = 'host';
            host.textContent = msg.hostname || '-';

            const app = document.createElement('span');
            app.className = 'app';
            app.textContent = msg.app_name || '-';

            const text = document.createElement('span');
            text.className = 'msg';
            text.textContent = msg.message;

            entry.appendChild(ts);
            entry.appendChild(node);
            entry.appendChild(sev);
            entry.appendChild(host);
            entry.appendChild(app);
            entry.appendChild(text);

            // Apply filter to new log
            if (currentFilter && !entry.textContent.toLowerCase().includes(currentFilter)) {
                entry.style.display = 'none';
            }

            logContainer.appendChild(entry);

            // Auto-scroll
            if (autoScroll.checked) {
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            // Keep only last 1000 logs
            if (logContainer.children.length > 1000) {
                logContainer.removeChild(logContainer.firstChild);
            }
        };

        function getSeverityName(sev) {
            const names = ['emerg', 'alert', 'crit', 'err', 'warn', 'notice', 'info', 'debug'];
            return names[sev] || 'unknown';
        }
    </script>
</body>

</html>